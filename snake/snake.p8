pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
	snake={
		segments={}
	}
	apple={
		x=rnd(104)+8,
		y=rnd(104)+8
	}
	score=0
	speed=0
	
	make_segment(56,56)
	
	gameover=false
end

function _update()
	if not gameover then
		speed+=1
		update_apple()
	
		if speed>=6 then
			update_snake()
			speed=0
		end
	else
		if btnp(4) then
			_init()
		end
	end
end

function _draw()
	cls()
	if not gameover then
		draw_apple()
		draw_snake()
		map(0,0)
		print(score,10,10,7)
	else
		print('game over',44,50,7)
		print('score:',44,56,7)
		print(score,70,56,7)
		print('press z',48,62,7)
	end
end

function make_segment(xpos,ypos)
	segment={
		x=xpos,
		y=ypos,
		lx=0,
		ly=0,
		inv=false,
	}
	
	add(snake.segments,segment)
end

function update_snake()
	flag=false
	
	snake.segments[1].lx=snake.segments[1].x
	snake.segments[1].ly=snake.segments[1].y
		
	if btn(0) then
		snake.segments[1].x-=8
		flag=true
		snake.segments[1].inv=false
	end
	if btn(1) then
		snake.segments[1].x+=8
		flag=true
		snake.segments[1].inv=true
	end
	if btn(2) then
		snake.segments[1].y-=8
		flag=true
		snake.segments[1].inv=false
	end
	if btn(3) then
		snake.segments[1].y+=8
		flag=true
		snake.segments[1].inv=false
	end			
	
	if flag then
		sfx(0)
		for i=2,count(snake.segments),1 do
			snake.segments[i].lx=snake.segments[i].x
		 snake.segments[i].ly=snake.segments[i].y
			snake.segments[i].x=snake.segments[i-1].lx
			snake.segments[i].y=snake.segments[i-1].ly
		end
	end
	
	if ovlp_ss() or ovlp_bd() then
		gameover=true
	end
end

function draw_snake()
	for seg in all(snake.segments) do
		spr(1,seg.x,seg.y,1,1,seg.inv)	
	end
end

function update_apple()
	if ovlp_as() then
		sfx(1)
		score+=1
		apple.x=rnd(104)+8
		apple.y=rnd(104)+8
		
		seg=snake.segments[count(snake.segments)]
		make_segment(seg.lx,seg.ly)
	end
end

function draw_apple()
	spr(3,apple.x,apple.y)
end

function ovlp_as()
	local dx=mid(-100,apple.x-snake.segments[1].x,100)
	local dy=mid(-100,apple.y-snake.segments[1].y,100)
	
	return dx*dx+dy*dy<64
end

function ovlp_ss()
	local ini = snake.segments[1]
	
	for i=3,count(snake.segments),1 do
		local dx=mid(-100,ini.x-snake.segments[i].x,100)
		local dy=mid(-100,ini.y-snake.segments[i].y,100)
	
		if dx*dx+dy*dy<64 then return true end
	end
	
	return false
end

function ovlp_bd()
	local ini = snake.segments[1]
	
	if ini.x==0 or
				ini.x==120 or
				ini.y==0 or
				ini.y==120 then
		return true
	end
	
	return false
end
__gfx__
00000000333333333333333300044000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000333333333333333300004000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070033333333333333330eeee880777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770003333333333333333e8888888777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770003333333333333333888888e8777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007003333333333333333888888e8777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000333333333333333388888888777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000333333333333333308888880777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0400000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100002e070240001d0001100011000110000c00009000080000700006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000600001205014050160500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
